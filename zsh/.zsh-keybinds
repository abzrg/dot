# Use vim bindings
bindkey -v

# Set escape timeout to be 1 milisecond (??)
export KEYTIMEOUT=1

zmodload zsh/complist
bindkey -M menuselect 'h'     vi-backward-char
bindkey -M menuselect 'k'     vi-up-line-or-history
bindkey -M menuselect 'l'     vi-forward-char
bindkey -M menuselect 'j'     vi-down-line-or-history
bindkey -M menuselect 'left'  vi-backward-char
bindkey -M menuselect 'down'  vi-up-line-or-history
bindkey -M menuselect 'up'    vi-forward-char
bindkey -M menuselect 'right' vi-down-line-or-history

precmd() { echo -ne '\e[2 q' ;}
function zle-keymap-select () {
 case $KEYMAP in
     vicmd) echo -ne '\e[2 q';;      # block
     viins|main) echo -ne '\e[6 q';; # beam
 esac
}
zle -N zle-keymap-select
zle-line-init() {
 zle -K viins
 echo -ne "\e[6 q"
}
zle -N zle-line-init
echo -ne '\e[6 q'
precmd() { echo -ne '\e[6 q' ;}

# ci", ci', ci`, di", etc
autoload -U select-quoted
zle -N select-quoted
for m in visual viopp; do
for c in {a,i}{\',\",\`}; do
 bindkey -M $m $c select-quoted
done
done

# ci{, ci(, ci<, di{, etc
autoload -U select-bracketed
zle -N select-bracketed
for m in visual viopp; do
for c in {a,i}${(s..)^:-'()[]{}<>bB'}; do
 bindkey -M $m $c select-bracketed
done
done

# cs, ds, ys
autoload -Uz surround
zle -N delete-surround surround
zle -N add-surround surround
zle -N change-surround surround
bindkey -M vicmd cs change-surround
bindkey -M vicmd ds delete-surround
bindkey -M vicmd ys add-surround
bindkey -M visual S add-surround

# c-a, c-x
autoload -Uz incarg
zle -N incarg
bindkey -M emacs "^X^A" incarg
bindkey -M vicmd "^A" incarg

# ga
bindkey -M vicmd ga what-cursor-position

# alt-e:
autoload edit-command-line; zle -N edit-command-line
bindkey '\ee' edit-command-line

# c-o
stty discard undef

# emacs
bindkey '\e.' 'insert-last-word'
bindkey "^A" beginning-of-line
bindkey "^E" end-of-line
bindkey "^W" backward-kill-word
bindkey '^U' kill-whole-line
bindkey "^K" kill-line
bindkey "^B" backward-char
bindkey "^F" forward-char
bindkey "^Y" yank
bindkey '\ew' push-line-or-edit
bindkey -M viins ' ' magic-space
# bindkey '^H' backward-kill-word # ctrl+backspace
bindkey '^o' accept-and-hold
bindkey '^R' history-incremental-pattern-search-backward
bindkey '\ef' forward-word
bindkey '\eb' backward-word
bindkey '\ed' kill-word
bindkey '^D' delete-char-or-list

bindkey "^?" backward-delete-char

bindkey "^[[A" history-beginning-search-backward
bindkey "^[[B" history-beginning-search-forward
bindkey "\C-p" history-beginning-search-backward
bindkey "\C-n" history-beginning-search-forward
