#!/bin/sh

# -----------------------------------------------------------------------------
# Disable "spell-correction" for this commands:
alias \
    cp="cp -iv"                                                               \
    mv="mv -iv"                                                               \
    rm="rm -v"                                                                \
    mkd="mkdir -pv"                                                           \
    ln="ln -iv"

# -----------------------------------------------------------------------------
# Colorize commands
alias \
    grep="grep --color=auto --exclude-dir={.bzr,CVS,.git,.hg,.svn}"           \
    egrep="egrep --color=auto --exclude-dir={.bzr,CVS,.git,.hg,.svn}"         \
    fgrep="fgrep --color=auto --exclude-dir={.bzr,CVS,.git,.hg,.svn}"         \
    diff="diff"                                                               \

# # ----------------------------------------------------------------------------
# # ls
# alias \
#     ls='ls -hFG --color=never'                               \
#     l='ls'                                                  \
#     la='ls -A'                                              \
#     ll='ls -Ali'                                            \
#     sl='ls'

# EXA: a modern replacement for ‘ls’.
alias \
    ls='exa -bgh -sname --icons --group-directories-first'                    \
    la='ls -a'                                                                \
    ll='ls -l --git'                                                          \
    sl='ls'

# -----------------------------------------------------------------------------
# Long commands
alias \
    bc='bc -ql'                                                               \
    df='df -h'                                                                \
    v="$EDITOR"                                                               \
    g="git"                                                                   \
    ka="killall"                                                              \
    type="type -a"                                                            \
    free='free -m'                                                            \
    chbin='chmod 755'                                                         \
    chreg='chmod 644'                                                         \
    wget="wget --hsts-file ~/.cache/wget-hsts"                                \
    myip="curl http://myip.dnsomatic.com && echo ''"                          \

# -----------------------------------------------------------------------------
# Directories
alias \
    cd..='cd ..'                                                              \
    cf="cd ${XDG_CONFIG_HOME:-$HOME/.config}"                                 \
    dl="cd ${XDG_DOWNLOAD_DIR:-$HOME/Downloads}"                              \
    dt="cd ${XDG_DATA_HOME:-$HOME/.local/share}"                              \
    bin="cd $HOME/.local/bin"                                                 \
    doc="cd ${XDG_DOCUMENTS_DIR:-$HOME/Documents}"                            \
    pic="cd ${XDG_PICTURES_DIR:-$HOME/Pictures}"                              \
    vid="cd ${XDG_VIDEOS_DIR:-$HOME/Movies}"                                  \

# -----------------------------------------------------------------------------
# Config files
alias \
    cfz="$EDITOR $HOME/.zshrc"                                                \
    cfzp="$EDITOR $HOME/.zprofile"                                            \
    cft="$EDITOR $HOME/.tmux.conf"                                            \
    cfa="$EDITOR ${HOME}/.aliasrc"                                            \
    cfA="$EDITOR ${HOME}/.config/alacritty/alacritty.yml"                     \


# Even more ease with global aliases
#  source: https://opensource.com/article/18/9/tips-productivity-zsh
alias -g GR='| grep -i'
alias -g VV=' |& nvim -'
alias -g LL=' |& less'
# NOTE: '|&' == '2>&1 |' (https://stackoverflow.com/a/35917682/13041067)

# -----------------------------------------------------------------------------
# youtube-dl / yt-dlp

alias yt="yt-dlp --add-metadata -ci --external-downloader aria2c --external-downloader-args '-c -x 5 -k 2M '"    \
    yta="yt -x -f bestaudio/best"       \
    ytb="yt -f bestvideo+bestaudio"     \
    yt7="yt -f 'bestvideo[height<=?720]+bestaudio/best' " \
    yts="yt-dlp --all-subs --skip-download" \
    ytas="yt-dlp --skip-download --write-auto-sub --convert-subs=srt" \
    yt7pl="yt7 -o '%(playlist_index)s-%(title)s.%(ext)s'" \
    ytbpl="ytb -o '%(playlist_index)s-%(title)s.%(ext)s'"

# OpenFoam
alias of21="source ~/OpenFOAM/OpenFOAM-v2106/etc/bashrc 2>/dev/null"

# vim and neovim config
alias cfv="$EDITOR ${XDG_CONFIG_HOME:-$HOME/.config}/nvim/init.lua"

# ascii table
alias ascii='man ascii | grep -m 1 -A 63 --color=never Oct | less'

# special regex
alias reg_mac='echo ^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$'
alias reg_git_hash='echo \b[0-9a-f]{5,40}\b'

# Pretty print the path
alias path='echo $PATH | tr -s ":" "\n"'

# Use nevim for vim if present.
command -v nvim >/dev/null && alias vimdiff="nvim -d"


# -----------------------------------------------------------------------------
# --- FUNCTIONS
# -----------------------------------------------------------------------------

# Dictionary (sdcv)
# Data in ~/.local/share/stardict/dic/
d() {
    [ $(tput cols) -lt 80 ] && local width=$(tput cols)
    sdcv -n --utf8-output --color "$@" 2>&1 \
        | sed 's/<br>/\n/g' \
        | sed 's/<BR>/\n/g' \
        | sed -e 's/<[^>]*>//g' \
        | fold -s -w ${width:-80} | less -FRX
}

# Extract everything
ex() {
    # -- ARCHIVE EXTRACTION
    # usage: ex <file>
    if [ -f $1 ] ; then
        case $1 in
            *.tar.bz2)   tar xjf $1   ;;
            *.tar.gz)    tar xzf $1   ;;
            *.bz2)       bunzip2 $1   ;;
            *.rar)       unrar x $1   ;;
            *.gz)        gunzip $1    ;;
            *.tar)       tar xf $1    ;;
            *.tbz2)      tar xjf $1   ;;
            *.tgz)       tar xzf $1   ;;
            *.zip)       unzip $1     ;;
            *.Z)         uncompress $1;;
            *.7z)        7z x $1      ;;
            *.deb)       ar x $1      ;;
            *.tar.xz)    tar xf $1    ;;
            *.tar.zst)   unzstd $1    ;;
            *)           echo "'$1' cannot be extracted via ex()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# b - browse chrome bookmarks (dependency: jq)
bk() {
     bookmarks_path=~/.config/BraveSoftware/Brave-Browser/Default/Bookmarks

     jq_script='
        def ancestors: while(. | length >= 2; del(.[-1,-2]));
        . as $in | paths(.url?) as $key | $in | getpath($key) | {name,url, path: [$key[0:-2] | ancestors as $a | $in | getpath($a) | .name?] | reverse | join("/") } | .path + "/" + .name + "\t" + .url'

    jq -r "$jq_script" < "$bookmarks_path" \
        | sed -E $'s/(.*)\t(.*)/\\1\t\x1b[36m\\2\x1b[m/g' \
        | fzf --layout=reverse --ansi \
        | cut -d$'\t' -f2 \
        | xargs xdg-open &>/dev/null
}

# Create files containing list of all files and folders under the ~
# These files are created for faster access in following functions
update_fzf() {
    # Update fzf files & directories
    find $HOME -type f 2>/dev/null | \
        egrep -v ".cache|.git|.svn" \
        > ~/.cache/files

    find $HOME -type d 2>/dev/null | \
        egrep -v ".cache|.git|.svn" \
        > ~/.cache/directories
}
cd_with_fzf() {
    cd "$(\
        cat ~/.cache/directories | \
        fzf --preview="tree -C -L 1 {}" \
        --layout=reverse \
        --bind="ctrl-x:toggle-preview" --preview-window=:right \
        )"
}
cd_recent_dirs_fzf() {
    cd "$(dirs -v | awk '{print $2}' | fzf)"
}


# go to the root of the project seamlessly
cdp() {
    TEMP_PWD=`pwd`
    while ! [ -d .git ]; do
        cd ..
    done
    OLDPWD=$TEMP_PWD
}

# go to the directory of a background job
# source: https://unix.stackexchange.com/a/82217/419393
cdjob () {
    pid=$(jobs -p $1);
    d=$(readlink /proc/$pid/cwd);
    cd "$d"
}

# Download papers from scihub
shdl1() { curl -O $(curl -s https://sci-hub.se/"$@" | grep location.href | grep -o http.*pdf) ;}
shdl2() { curl -O "https:"$(curl -s https://sci-hub.se/"$@" | grep location.href | grep -o '//.*pdf') ;}

# Create a directory and take me there
take() { mkdir $1 && cd $1 }

alias load_nit_server='nitfwd.sh -h hpc.nit.ac.ir -u a.bozorgzadeh -n a.bozorgzadeh1 -i 10.1.2.39 -vnc 5907 -ssh 5909'
alias paraview='/Applications/ParaView-5.10.0.app/Contents/MacOS/paraview'
